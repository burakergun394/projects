$().ready(function () { $("body").prepend('<div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body"><div class="col-12"><div class="form-group files"><input type="file" id="fileImage" onchange="changeImageEdit(this)" class="form-control" ></div><canvas id="canvas"></canvas><div id="croppieImage"></div><img id="imageResult"  style="max-width: 200px;" class=" w-auto p-3"/><div class="d-block d-flex flex-column justify-content-center align-items-center mb-4 mt-2"><label style="font-weight:600;" id="previewText" ></label><img id="imageResizeFinal" style="max-width: 200px;" class="imageResizeFinal" /></div></div><div class="justify-content-between w-75 m-auto"></div></div><div class="modal-footer justify-content-between"><div><div class="mb-3"><label id="labelWidthHeight" class="text-danger d-block "></label><div class="d-flex"><input id="inputWidth" class="form-control mr-2 w-25" type="text" placeholder="Genişlik" /><input id="inputHeight" class="form-control w-25" type="text" placeholder="Yükseklik" /></div><div class="form-check mt-2"><input class="form-check-input" type="checkbox" value="" id="aspectRatioChecked" checked><label class="form-check-label " for="aspectRatioChecked">En / Boy oranını koru</label></div></div><div><button type="button" id="imageCrop" class="btn btn-info btn-sm mr-2">Kırp</button><button type="button" id="imageRotate" class="btn btn-info btn-sm mr-2">Döndür</button><button type="button" id="imageResize" class="btn btn-info btn-sm mr-2">Yeniden Boyutlandır</button><button type="button" id="imageSave" class="btn btn-success btn-sm mr-2">Kaydet</button></div></div><div><br /><br /><br /><br /><button type="button" class="btn btn-danger btn-sm mt-3" data-dismiss="modal">Kapat</button></div></div></div></div></div>') }); let image_crop, modal = document.getElementById("imageModal"), imageResult = document.getElementById("imageResult"), imageWidth = 0, imageHeight = 0, reSizeImageSrc = "", imageFormatType = "", cropper = "", croppable = !1, finalImage = "", finalHiddenValue = "", canvasData = ""; const changeImageEdit = e => { $("#imageResizeFinal").attr("src", ""), $("#previewText").text(""), $("#croppieImage").remove(), $(".modal-body .col-12").append('<div id="croppieImage"></div>'), image_crop = $("#croppieImage").croppie({ enableExif: !0, viewport: { width: imageWidth, height: imageHeight }, boundary: { width: imageWidth, height: imageHeight }, enableZoom: !0, enforceBoundary: !1, enableOrientation: !0, enableResize: !1 }), readURL(e) }; function readURL(e) { if (e.files && e.files[0]) { var t = new FileReader; t.onload = function (e) { image_crop.croppie("bind", { url: e.target.result, orientation: 1 }).then(function () { imageFormatType = getExtension(e.target.result), reSizeImageSrc = e.target.result, (imageResult = document.getElementById("imageResult")).src = e.target.result, reSizeImageCanvas($("#inputWidth").val(), $("#inputHeight").val()) }) }, t.readAsDataURL(e.files[0]) } } function openModal(e, t, i, a) { imageWidth = e, imageHeight = t, finalImage = document.getElementById(i.id), finalHiddenValue = document.getElementById(a.id), $("#imageResult").hide(), $("#inputWidth").val(imageWidth), $("#inputHeight").val(imageHeight), $("#labelWidthHeight").text("İstenilen Resim Boyutu : " + $("#inputWidth").val() + " x " + $("#inputHeight").val()), $("#imageModal").modal(), $("#croppieImage").remove(), $("#imageResizeFinal").attr("src", ""), $("#fileImage").val(""), $("#previewText").text("") } function getAspectRatio() { return imageWidth / imageHeight } function resultFun() { image_crop.croppie("result", { type: "canvas", size: "viewport", format: imageFormatType }).then(function (e) { $(".imageResizeFinal").attr("src", e), $("#previewText").text("Önizleme") }) } function reSizeResultFun(e, t) { $("#croppieImage").remove(), $(".modal-body .col-12").append('<div id="croppieImage"></div>'); let i = canvasData; (image_crop = $("#croppieImage").croppie({ enableExif: !0, viewport: { width: imageWidth, height: imageHeight }, boundary: { width: imageWidth, height: imageHeight }, enableZoom: !0, enforceBoundary: !1, enableOrientation: !0 })).croppie("bind", { url: i, orientation: 1, format: imageFormatType }), $(".imageResizeFinal").attr("src", i), $("#previewText").text("Önizleme") } function reSizeImageCanvas(e, t) { let i = document.createElement("img"); $("#canvas").hide(), i.src = reSizeImageSrc; let a = document.createElement("canvas"), n = a.getContext("2d"); n.drawImage(i, 0, 0), a.width = e, a.height = t, n.drawImage(i, 0, 0, e, t), "png" == imageFormatType ? canvasData = a.toDataURL("image/png") : "jpeg" == imageFormatType && (canvasData = a.toDataURL("image/jpeg")) } function rotateFun() { image_crop.croppie("rotate", 90) } function getExtension(e) { return e.substring("data:image/".length, e.indexOf(";base64")) } $("body").on("click", "#imageRotate", function () { rotateFun(), resultFun() }), $("body").on("click", "#imageResize", function () { reSizeResultFun(document.getElementById("inputWidth").value, document.getElementById("inputHeight").value) }), $("body").on("click", "#imageCrop", function () { resultFun() }), $("body").on("click", "#imageSave", function () { let e = document.getElementById("imageResizeFinal").src; e.startsWith("data:image/") ? (finalImage.src = e, finalHiddenValue.value = e, $("#imageModal").modal("hide")) : Promise.resolve(resultFun()).then(function () { e = document.getElementById("imageResizeFinal").src, finalImage.src = e, finalHiddenValue.value = e, $("#imageModal").modal("hide") }) }), $("body").on("change keyup", "#inputWidth", function () { if ($("input#aspectRatioChecked").prop("checked")) { let e = $("#inputWidth").val(), t = imageWidth / imageHeight, i = Math.round(e / t); $("#inputHeight").val(i), reSizeImageCanvas($("#inputWidth").val(), $("#inputHeight").val()) } else reSizeImageCanvas($("#inputWidth").val(), $("#inputHeight").val()) }), $("body").on("change keyup", "#inputHeight", function () { if ($("input#aspectRatioChecked").prop("checked")) { let e = $("#inputHeight").val(), t = imageWidth / imageHeight, i = Math.round(e * t); $("#inputWidth").val(i), reSizeImageCanvas($("#inputWidth").val(), $("#inputHeight").val()) } else reSizeImageCanvas($("#inputWidth").val(), $("#inputHeight").val()) });